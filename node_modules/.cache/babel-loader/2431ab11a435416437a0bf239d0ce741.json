{"remainingRequest":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\thread-loader\\dist\\cjs.js!F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\babel-loader\\lib\\index.js!F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\src\\views\\Message\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\src\\views\\Message\\index.vue","mtime":1618496982170},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\Webstromfiles\\录播课程\\VUE2\\入门\\搭建工程\\my-cite\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkY6L1dlYnN0cm9tZmlsZXMvXHU1RjU1XHU2NEFEXHU4QkZFXHU3QTBCL1ZVRTIvXHU1MTY1XHU5NUU4L1x1NjQyRFx1NUVGQVx1NURFNVx1N0EwQi9teS1jaXRlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgTWVzc2FnZUFyZWEgZnJvbSAiQC9jb21wb25lbnRzL01lc3NhZ2VBcmVhIjsKaW1wb3J0IGZldGNoRGF0YSBmcm9tICJAL21peGlucy9mZXRjaERhdGEuanMiOwppbXBvcnQgKiBhcyBtc2dBcGkgZnJvbSAiQC9hcGkvbWVzc2FnZS5qcyI7CmltcG9ydCBtYWluU2Nyb2xsIGZyb20gIkAvbWl4aW5zL21haW5TY3JvbGwiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImluZGV4IiwKICBtaXhpbnM6IFtmZXRjaERhdGEoewogICAgdG90YWw6IDAsCiAgICByb3dzOiBbXQogIH0pLCBtYWluU2Nyb2xsKCJtZXNzYWdlQ29udGFpbmVyIildLAogIGNvbXBvbmVudHM6IHsKICAgIE1lc3NhZ2VBcmVhOiBNZXNzYWdlQXJlYQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBhZ2U6IDEsCiAgICAgIGxpbWl0OiAxMAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBoYXNNb3JlOiBmdW5jdGlvbiBoYXNNb3JlKCkgewogICAgICByZXR1cm4gdGhpcy5kYXRhLnJvd3MubGVuZ3RoIDwgdGhpcy5kYXRhLnRvdGFsOwogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuJGJ1cy4kb24oIm1haW5TY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7CiAgfSwKICBkZXN0cm95ZWQ6IGZ1bmN0aW9uIGRlc3Ryb3llZCgpIHsKICAgIHRoaXMuJGJ1cy4kb2ZmKCJtYWluU2Nyb2xsIiwgdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0sCiAgbWV0aG9kczogewogICAgZmV0Y2hEYXRhOiBmdW5jdGlvbiBmZXRjaERhdGEoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIG1zZ0FwaS5nZXRNZXNzYWdlKF90aGlzLnBhZ2UsIF90aGlzLmxpbWl0KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBoYW5kbGVTdWJtaXQ6IGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChkYXRhLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciByZXNwOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gbXNnQXBpLnBvc3RNZXNzYWdlKGRhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygi5oSf6LCi5oKo55qE55WZ6KiAIik7CgogICAgICAgICAgICAgICAgX3RoaXMyLmRhdGEucm93cy51bnNoaWZ0KHJlc3ApOwoKICAgICAgICAgICAgICAgIF90aGlzMi5kYXRhLnRvdGFsKys7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGZldGNoTW9yZTogZnVuY3Rpb24gZmV0Y2hNb3JlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciByZXNwOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMzLmhhc01vcmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIC8v6L+Y5pyJ5pyq5Yqg6L295a6M55qE6K+E6K66CiAgICAgICAgICAgICAgICBfdGhpczMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF90aGlzMy5wYWdlKys7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzLmZldGNoRGF0YSgpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBfdGhpczMuZGF0YS50b3RhbCA9IHJlc3AudG90YWw7CiAgICAgICAgICAgICAgICBfdGhpczMuZGF0YS5yb3dzID0gX3RoaXMzLmRhdGEucm93cy5jb25jYXQocmVzcC5yb3dzKTsKICAgICAgICAgICAgICAgIF90aGlzMy5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGhhbmRsZVNjcm9sbDogZnVuY3Rpb24gaGFuZGxlU2Nyb2xsKGRvbSkgewogICAgICBpZiAodGhpcy5pc0xvYWRpbmcgfHwgIWRvbSkgewogICAgICAgIC8v5b2T5YmN5q2j5Zyo5Yqg6L296K+E6K66CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcmFuZ2UgPSAxMDA7CiAgICAgIHZhciBkZWMgPSBNYXRoLmFicyhkb20uc2Nyb2xsVG9wICsgZG9tLmNsaWVudEhlaWdodCAtIGRvbS5zY3JvbGxIZWlnaHQpOwoKICAgICAgaWYgKGRlYyA8IHJhbmdlKSB7CiAgICAgICAgdGhpcy5mZXRjaE1vcmUoKTsKICAgICAgfQogICAgfQogIH0KfTs="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAYA,OAAA,WAAA,MAAA,0BAAA;AACA,OAAA,SAAA,MAAA,uBAAA;AACA,OAAA,KAAA,MAAA,MAAA,kBAAA;AACA,OAAA,UAAA,MAAA,qBAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,OADA;AAEA,EAAA,MAAA,EAAA,CAAA,SAAA,CAAA;AAAA,IAAA,KAAA,EAAA,CAAA;AAAA,IAAA,IAAA,EAAA;AAAA,GAAA,CAAA,EAAA,UAAA,CAAA,kBAAA,CAAA,CAFA;AAGA,EAAA,UAAA,EAAA;AACA,IAAA,WAAA,EAAA;AADA,GAHA;AAMA,EAAA,IANA,kBAMA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,CADA;AAEA,MAAA,KAAA,EAAA;AAFA,KAAA;AAIA,GAXA;AAYA,EAAA,QAAA,EAAA;AACA,IAAA,OADA,qBACA;AACA,aAAA,KAAA,IAAA,CAAA,IAAA,CAAA,MAAA,GAAA,KAAA,IAAA,CAAA,KAAA;AACA;AAHA,GAZA;AAiBA,EAAA,OAjBA,qBAiBA;AACA,SAAA,IAAA,CAAA,GAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAnBA;AAoBA,EAAA,SApBA,uBAoBA;AACA,SAAA,IAAA,CAAA,IAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAtBA;AAuBA,EAAA,OAAA,EAAA;AACA,IAAA,SADA,uBACA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,MAAA,CAAA,UAAA,CAAA,KAAA,CAAA,IAAA,EAAA,KAAA,CAAA,KAAA,CADA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,KAHA;AAIA,IAAA,YAJA,wBAIA,IAJA,EAIA,QAJA,EAIA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,MAAA,CAAA,WAAA,CAAA,IAAA,CADA;;AAAA;AACA,gBAAA,IADA;AAEA,gBAAA,QAAA,CAAA,QAAA,CAAA;;AACA,gBAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,OAAA,CAAA,IAAA;;AACA,gBAAA,MAAA,CAAA,IAAA,CAAA,KAAA;;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA,KATA;AAUA,IAAA,SAVA,uBAUA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEA,MAAA,CAAA,OAFA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAKA;AACA,gBAAA,MAAA,CAAA,SAAA,GAAA,IAAA;AACA,gBAAA,MAAA,CAAA,IAAA;AAPA;AAAA,uBAQA,MAAA,CAAA,SAAA,EARA;;AAAA;AAQA,gBAAA,IARA;AASA,gBAAA,MAAA,CAAA,IAAA,CAAA,KAAA,GAAA,IAAA,CAAA,KAAA;AACA,gBAAA,MAAA,CAAA,IAAA,CAAA,IAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACA,gBAAA,MAAA,CAAA,SAAA,GAAA,KAAA;;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA,KAtBA;AAuBA,IAAA,YAvBA,wBAuBA,GAvBA,EAuBA;AACA,UAAA,KAAA,SAAA,IAAA,CAAA,GAAA,EAAA;AACA;AACA;AACA;;AACA,UAAA,KAAA,GAAA,GAAA;AACA,UAAA,GAAA,GAAA,IAAA,CAAA,GAAA,CAAA,GAAA,CAAA,SAAA,GAAA,GAAA,CAAA,YAAA,GAAA,GAAA,CAAA,YAAA,CAAA;;AACA,UAAA,GAAA,GAAA,KAAA,EAAA;AACA,aAAA,SAAA;AACA;AACA;AAjCA;AAvBA,CAAA","sourcesContent":["<template>\r\n<div class=\"message-container\" ref=\"messageContainer\">\r\n  <MessageArea title=\"留言板\"\r\n               :is-list-loading=\"isLoading\"\r\n               :list=\"data.rows\"\r\n               :sub-title=\"`(${data.total})`\"\r\n               @submit=\"handleSubmit\"\r\n  />\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport MessageArea from \"@/components/MessageArea\";\r\nimport fetchData from \"@/mixins/fetchData.js\";\r\nimport * as msgApi from \"@/api/message.js\";\r\nimport mainScroll from \"@/mixins/mainScroll\";\r\nexport default {\r\n  name: \"index\",\r\n  mixins: [fetchData({total: 0, rows: []}), mainScroll(\"messageContainer\")],\r\n  components: {\r\n    MessageArea\r\n  },\r\n  data(){\r\n    return {\r\n      page: 1,\r\n      limit: 10\r\n    }\r\n  },\r\n  computed:{\r\n    hasMore(){\r\n      return this.data.rows.length < this.data.total;\r\n    }\r\n  },\r\n  created(){\r\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\r\n  },\r\n  destroyed() {\r\n    this.$bus.$off(\"mainScroll\", this.handleScroll);\r\n  },\r\n  methods: {\r\n    async fetchData(){\r\n      return await msgApi.getMessage(this.page, this.limit);\r\n    },\r\n    async handleSubmit(data, callback){\r\n      const resp = await msgApi.postMessage(data);\r\n      callback(\"感谢您的留言\");\r\n      this.data.rows.unshift(resp);\r\n      this.data.total++;\r\n    },\r\n    async fetchMore(){\r\n      //所有评论加载完成\r\n      if (!this.hasMore){\r\n        return;\r\n      }\r\n      //还有未加载完的评论\r\n      this.isLoading = true;\r\n      this.page++;\r\n      const resp = await this.fetchData();\r\n      this.data.total = resp.total;\r\n      this.data.rows = this.data.rows.concat(resp.rows);\r\n      this.isLoading = false;\r\n    },\r\n    handleScroll(dom){\r\n      if (this.isLoading || !dom){\r\n        //当前正在加载评论\r\n        return;\r\n      }\r\n      const range = 100;\r\n      const dec = Math.abs((dom.scrollTop + dom.clientHeight) - dom.scrollHeight);\r\n      if (dec < range){\r\n        this.fetchMore();\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.message-container{\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  padding: 25px 0;\r\n  box-sizing: border-box;\r\n  scroll-behavior: smooth;\r\n}\r\n.message-area-container{\r\n  width: 900px;\r\n  margin: 0 auto;\r\n}\r\n</style>"],"sourceRoot":"src/views/Message"}]}